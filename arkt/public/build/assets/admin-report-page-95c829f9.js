import{v as O,bT as q,e as U,j as t,c as h,P as W,T as x,r as c,aC as Z,cb as Q,d1 as J,bG as S,bJ as A,av as Y,bv as b,a as X,f as ee,d2 as te,d as v,Z as R,B as $,aF as se,A as ae,m as I,o as z,Y as re,bu as M,z as ne,bF as ie,a0 as oe}from"./main-78369d74.js";import{T as le,a as ce,b as me}from"./TrendingUp-106059f4.js";import{t as F,A as de,F as w,a as ue,D as xe,b as ge,u as P,c as fe,d as pe,e as he}from"./admin-routes-f73f0351.js";import{I as je}from"./info-dialog-trigger-7dec76dd.js";import"./Edit-d653f744.js";import"./blank-page-skeleton-9a989fe2.js";import"./DragIndicator-a74a52aa.js";import"./use-delete-domain-9b2df6bf.js";import"./OpenInNew-307c172e.js";import"./ChevronRight-4d13b02f.js";const G="admin/reports";function be(e={}){return O({queryKey:[G,e],queryFn:()=>ve(e),placeholderData:q})}function ve({types:e,dateRange:a}){const s={};return e&&(s.types=e.join(",")),a&&(s.startDate=a.start.toAbsoluteString(),s.endDate=a.end.toAbsoluteString(),s.timezone=a.start.timeZone),U.get(G,{params:s}).then(r=>r.data)}function B(e){const{title:a,description:s,children:r,className:n,contentIsFlex:i=!0,contentClassName:l,contentRef:o,minHeight:d="min-h-440"}=e;return t.jsxs("div",{className:h("flex h-full flex-auto flex-col rounded-panel border bg dark:bg-alt",d,n),children:[t.jsxs("div",{className:"flex flex-shrink-0 items-center justify-between p-14 text-xs",children:[t.jsx("div",{className:"text-sm font-semibold",children:a}),s&&t.jsx("div",{className:"text-muted",children:s})]}),t.jsx("div",{ref:o,className:h("relative p-14",i&&"flex flex-auto items-center justify-center",l),children:r})]})}function N(){return t.jsxs("div",{className:"flex items-center gap-10 text-sm absolute mx-auto",children:[t.jsx(W,{isIndeterminate:!0,size:"sm"}),t.jsx(x,{message:"Chart loading"})]})}const we=c.lazy(()=>Z(()=>import("./lazy-chart-8b2242c3.js"),["./lazy-chart-8b2242c3.js","./main-78369d74.js","./main-3995081f.css"],import.meta.url));function y(e){const{title:a,description:s,className:r,contentRef:n,isLoading:i}=e;return t.jsx(B,{title:a,description:s,className:r,contentRef:n,children:t.jsxs(c.Suspense,{fallback:t.jsx(N,{}),children:[t.jsx(we,{...e}),i&&t.jsx(N,{})]})})}function D(e,{localeCode:a="en",shareFirstDatasetLabels:s=!0}){if(!e)return{datasets:[]};const r=[];return{...e,datasets:e.datasets.map((n,i)=>{const l=n.data.map((o,d)=>{let m;return i===0||!s?(m=Ne(o,e.granularity,a),r[d]=m):m=r[d],{...m,value:o.value}});return{...n,data:l}})}}function Ne(e,a,s){return e.label?{label:e.label}:e.date?ye(e,a,s):{label:""}}function ye({date:e,endDate:a},s="day",r){const n=A(e).toDate(),i=a?A(a).toDate():null;switch(s){case"minute":return{label:u(r,{second:"2-digit"}).format(n),tooltipTitle:u(r,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(n)};case"hour":return{label:u(r,{hour:"numeric",minute:"numeric"}).format(n),tooltipTitle:u(r,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(n)};case"day":return{label:u(r,{day:"2-digit",weekday:"short"}).format(n),tooltipTitle:u(r,{day:"2-digit",weekday:"short",month:"short"}).format(n)};case"week":return{label:u(r,{month:"short",day:"2-digit"}).format(n),tooltipTitle:u(r,{day:"2-digit",month:"long",year:"numeric"}).formatRange(n,i)};case"month":return{label:u(r,{month:"short",year:"numeric"}).format(n),tooltipTitle:u(r,{month:"long",year:"numeric"}).format(n)};case"year":return{label:u(r,{year:"numeric"}).format(n),tooltipTitle:u(r,{year:"numeric"}).format(n)}}}const u=Q((e,a)=>new J(e,a),{equals:(e,a)=>S(e,a),callTimeout:void 0}),V=Y().themes.all[0].values["--be-primary"],g=[[`rgb(${V.replaceAll(" ",",")})`,`rgba(${V.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],De={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function Ce({data:e,className:a,...s}){const{localeCode:r}=b(),n=c.useMemo(()=>{const i=D(e,{localeCode:r});return i.datasets=i.datasets.map((l,o)=>({...l,backgroundColor:g[o][1],borderColor:g[o][0],pointBackgroundColor:g[o][0]})),i},[e,r]);return t.jsx(y,{...s,className:h(a,"min-w-500"),data:n,type:"line",options:De})}const Te={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function ke({data:e,className:a,...s}){const{localeCode:r}=b(),n=c.useMemo(()=>{var l;const i=D(e,{localeCode:r});return i.labels=(l=i.datasets[0])==null?void 0:l.data.map(o=>o.label),i.datasets=i.datasets.map((o,d)=>({...o,backgroundColor:g.map(m=>m[1]),borderColor:g.map(m=>m[0]),borderWidth:2})),i},[e,r]);return t.jsx(y,{type:"polarArea",data:n,options:Te,className:h(a,"min-w-500"),...s})}function Ae({data:e,direction:a="vertical",individualBarColors:s=!1,className:r,...n}){const{localeCode:i}=b(),l=c.useMemo(()=>{const m=D(e,{localeCode:i});return m.datasets=m.datasets.map((p,j)=>({...p,backgroundColor:s?g.map(f=>f[1]):g[j][1],borderColor:s?g.map(f=>f[0]):g[j][0],borderWidth:2})),m},[e,i,s]),o=a==="horizontal",d=c.useMemo(()=>({indexAxis:o?"y":"x",parsing:{xAxisKey:o?"value":"label",yAxisKey:o?"label":"value"}}),[o]);return t.jsx(y,{type:"bar",className:h(r,"min-w-500"),data:l,options:d,...n})}const L="https://www.gstatic.com/charts/loader.js";function Re({placeholderRef:e,data:a,country:s,onCountrySelected:r}){const{trans:n}=X(),{analytics:i}=ee(),l=i==null?void 0:i.gchart_api_key,{selectedTheme:o}=te(),d=c.useRef(),m=!!r&&!s,p=c.useCallback(()=>{var C,T;if(typeof google>"u")return;const f=a.map(k=>[k.label,k.value]);f.unshift([n(s?v("City"):v("Country")),n(v("Clicks"))]);const K=`${F(o.values["--be-paper"])}`,H={colorAxis:{colors:[`${F(o.values["--be-primary"])}`]},backgroundColor:K,region:s?s.toUpperCase():void 0,resolution:s?"provinces":"countries",displayMode:s?"markers":"regions",enableRegionInteractivity:m};!d.current&&e.current&&((C=google==null?void 0:google.visualization)!=null&&C.GeoChart)&&(d.current=new google.visualization.GeoChart(e.current)),(T=d.current)==null||T.draw(google.visualization.arrayToDataTable(f),H)},[o,a,e,n,s,m]),j=c.useCallback(async()=>{R.isLoadingOrLoaded(L)||(await R.loadAsset(L,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:l}),p())},[l,p]);return c.useEffect(()=>(d.current&&r&&google.visualization.events.addListener(d.current,"regionClick",f=>r==null?void 0:r(f.region)),()=>{d.current&&google.visualization.events.removeAllListeners(d.current)}),[r,d.current]),c.useEffect(()=>{j()},[j]),c.useEffect(()=>{p()},[o,p,a]),{drawGoogleChart:p}}const Ie=c.memo(({code:e})=>{const{localeCode:a}=b(),s=new Intl.DisplayNames([a],{type:"region"});let r;try{r=s.of(e.toUpperCase())}catch{}return t.jsx(c.Fragment,{children:r})});function ze({data:e,isLoading:a,onCountrySelected:s,country:r,...n}){const i=c.useRef(null),l=!!s,o=e==null?void 0:e.datasets[0].data,d=c.useMemo(()=>o||[],[o]);return Re({placeholderRef:i,data:d,country:r,onCountrySelected:s}),t.jsxs(B,{...n,className:"min-w-500",title:t.jsxs("div",{className:"flex items-center",children:[t.jsx(x,{message:"Top Locations"}),r?t.jsxs("span",{className:"pl-4",children:["(",t.jsx(Ie,{code:r}),")"]}):null,l&&t.jsx(Fe,{})]}),contentIsFlex:a,children:[a&&t.jsx(N,{}),t.jsxs("div",{className:"flex gap-24",children:[t.jsx("div",{ref:i,className:"flex-auto w-[480px] min-h-[340px]"}),t.jsxs("div",{className:"w-[170px]",children:[t.jsx("div",{className:"text-sm max-h-[340px] w-full flex-initial overflow-y-auto",children:d.map(m=>t.jsxs("div",{className:h("flex items-center gap-4 mb-4",l&&"cursor-pointer hover:underline"),role:l?"button":void 0,onClick:()=>{s==null||s(m.code)},children:[t.jsx("div",{className:"max-w-110 whitespace-nowrap overflow-hidden overflow-ellipsis",children:m.label}),t.jsxs("div",{children:["(",m.percentage,")%"]})]},m.label))}),r&&t.jsx($,{variant:"outline",size:"xs",className:"mt-14",startIcon:t.jsx(de,{}),onClick:()=>{s==null||s(void 0)},children:t.jsx(x,{message:"Back to countries"})})]})]})]})}function Fe(){return t.jsx(je,{title:t.jsx(x,{message:"Zooming in"}),body:t.jsx(x,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const _="gap-12 md:gap-16 mb-12 md:mb-16",E=`flex flex-col md:flex-row md:items-center overflow-x-auto ${_}`;function Pe({report:e,isLoading:a}){const s=e==null?void 0:e.pageViews.total;return t.jsxs(c.Fragment,{children:[t.jsxs("div",{className:E,children:[t.jsx(Ce,{isLoading:a,className:"flex-auto",data:e==null?void 0:e.pageViews,title:t.jsx(x,{message:"Pageviews"}),description:s?t.jsx(x,{message:":count total views",values:{count:t.jsx(w,{value:s})}}):null}),t.jsx(ke,{isLoading:a,data:e==null?void 0:e.devices,title:t.jsx(x,{message:"Top devices"})})]}),t.jsxs("div",{className:E,children:[t.jsx(Ae,{isLoading:a,data:e==null?void 0:e.browsers,className:"flex-auto md:w-1/3",direction:"horizontal",individualBarColors:!0,hideLegend:!0,title:t.jsx(x,{message:"Top browsers"})}),t.jsx(ze,{isLoading:a,className:"flex-auto",data:e==null?void 0:e.locations,title:t.jsx(x,{message:"Top locations"})})]})]})}function Ve({report:e,isLoading:a}){return t.jsx("div",{className:`flex h-[97px] flex-shrink-0 items-center overflow-x-auto ${_}`,children:e==null?void 0:e.map(s=>t.jsx(Le,{datum:s,isLoading:a},s.name))})}function Le({datum:e,isLoading:a=!1}){let s;if(c.isValidElement(e.icon))s=c.cloneElement(e.icon,{size:"lg"});else{const r=se(e.icon);s=t.jsx(r,{size:"lg"})}return t.jsxs("div",{className:"rounded-panel flex h-full flex-auto items-center gap-18 whitespace-nowrap border p-20",children:[t.jsx("div",{className:"flex-shrink-0 rounded-lg bg-primary-light/20 p-10 text-primary",children:s}),t.jsxs("div",{className:"flex-auto",children:[t.jsx("div",{className:"flex items-center justify-between gap-20",children:t.jsx("div",{className:"text-lg font-bold text-main",children:t.jsx(ae,{initial:!1,mode:"wait",children:a?t.jsx(I.div,{...z,children:t.jsx(re,{className:"min-w-24"})},"skeleton"):t.jsx(I.div,{...z,children:t.jsx(Ee,{datum:e})},"value")})})}),t.jsxs("div",{className:"flex items-center justify-between gap-20",children:[t.jsx("h2",{className:"text-sm text-muted",children:e.name}),(e.percentageChange!=null||e.previousValue!=null)&&t.jsx("div",{className:"flex items-center gap-10",children:t.jsx($e,{datum:e})})]})]})]},e.name)}function Ee({datum:e}){switch(e.type){case"fileSize":return t.jsx(ue,{bytes:e.currentValue});case"percentage":return t.jsx(w,{value:e.currentValue,style:"percent",maximumFractionDigits:1});default:return t.jsx(w,{value:e.currentValue})}}function $e({datum:e}){const a=Me(e);let s;return a>0?s=t.jsx(le,{size:"md",className:"text-positive"}):a===0?s=t.jsx(ce,{className:"text-muted"}):s=t.jsx(me,{className:"text-danger"}),t.jsxs(c.Fragment,{children:[s,t.jsxs("div",{className:"text-sm font-semibold text-muted",children:[a,"%"]})]})}function Me({percentageChange:e,previousValue:a,currentValue:s}){return e!=null||a==null||s==null?e??0:a===0?100:Math.round((s-a)/a*100)}const Ge={month:"short",day:"2-digit"};function Be({value:e,onChange:a,disabled:s,compactOnMobile:r=!0,enableCompare:n=!1,granularity:i="minute"}){const l=M();return t.jsxs(ne,{type:"popover",onClose:o=>{o&&a(o)},children:[t.jsx($,{variant:"outline",color:"chip",endIcon:t.jsx(xe,{}),disabled:s,children:t.jsx(ge,{start:e.start,end:e.end,options:l&&r?Ge:ie.short})}),t.jsx(_e,{value:e,enableCompare:n,granularity:i})]})}function _e({value:e,enableCompare:a,granularity:s}){const r=M(),n=P({granularity:s,defaultValue:{start:e.start,end:e.end,preset:e.preset},closeDialogOnSelection:!1}),i=!!e.compareStart&&!!e.compareEnd,l=P({granularity:s,defaultValue:i?{start:e.compareStart,end:e.compareEnd,preset:e.comparePreset}:fe[0].getRangeValue(n.selectedValue)});return t.jsx(pe,{state:n,compareState:a?l:void 0,compareVisibleDefault:i,showInlineDatePickerField:!r})}function Xe(){const[e,a]=c.useState(()=>he[2].getRangeValue()),{isLoading:s,data:r}=be({dateRange:e}),n=t.jsx(x,{message:"Visitors report"});return t.jsxs("div",{className:"min-h-full gap-12 overflow-x-hidden p-12 md:gap-18 md:p-18",children:[t.jsxs("div",{className:"mb-24 items-center justify-between gap-24 md:flex",children:[t.jsx(oe,{children:n}),t.jsx("h1",{className:"mb-24 text-3xl font-light md:mb-0",children:n}),t.jsx(Be,{value:e,onChange:a})]}),t.jsx(Ve,{report:r==null?void 0:r.headerReport}),t.jsx(Pe,{report:r==null?void 0:r.visitorsReport,isLoading:s})]})}export{Xe as default};
//# sourceMappingURL=admin-report-page-95c829f9.js.map
